# Bili-DL-Sentinel (B站增量下载哨兵)

这是一个基于强大的 **`gallery-dl`** 工具的Python自动化脚本，专为批量、增量下载Bilibili用户的图文动态而设计。

## 解决了什么问题？

当您关注了许多B站UP主并希望备份他们的图文动态时，每次都手动检查或使用 `gallery-dl` 完整地重新下载所有内容是非常低效的。

本脚本的核心优势在于 **增量下载 (Incremental Download)**。它会自动扫描本地已存在的文件，然后仅下载每个用户的最新内容，直到遇到第一个已存在的文件为止。这极大地节省了时间和带宽，让您轻松保持本地备份与线上同步。

## 核心功能

- **批量处理**：自动按顺序处理预设列表中的所有用户。
- **智能增量**：只下载最新内容，遇到旧文件即停止当前用户的任务，并转向下一个。
- **配置简单**：只需在一个地方维护用户ID和其对应的本地文件夹名映射。
- **完全自动化**：一次配置，后续只需运行脚本即可完成所有更新。

## 环境要求

1.  **Python 3**: [Python官网](https://www.python.org/)
2.  **gallery-dl**: 脚本的核心依赖。请确保已正确安装并将其添加到了系统环境变量中。
    -   [gallery-dl 官方仓库与安装指南](https://github.com/mikf/gallery-dl)

## 如何使用

1.  **下载脚本**: 将项目脚本文件（例如 `run.py`）下载到您的电脑上。

2.  **配置脚本**: 打开脚本文件，您会看到顶部的配置区域。

    -   **配置路径**:
        ```python
        cookies_path = r"C:\Your\Path\to\space.bilibili.com_cookies.txt"
        download_dir = r"C:\Your\Path\to\gallery-dl"
        ```
        请将以上路径修改为您的实际路径。

    -   **填写用户映射表 (最关键的一步)**:
        找到 `user_map` 字典，并根据您的需求填写。字典的格式为：`"用户ID": "该用户在本地的文件夹名"`。
        ```python
        # 示例：
        user_map = {
            "10982073": "明前奶粉罐",
            # ... 请确保这里的文件夹名与 gallery-dl 实际创建的文件夹名完全一致
        }
        ```

3.  **运行脚本**:
    打开命令行工具 (CMD, PowerShell, Terminal等)，进入脚本所在目录，然后运行：
    ```bash
    python your_script_name.py
    ```
    脚本将开始自动化处理流程。

## 工作原理

脚本采用了一种精确的“预扫描+监控”策略：

1.  **预扫描 (Pre-scan)**：在处理每个用户之前，脚本会根据您在 `user_map` 中提供的信息，直接定位到该用户的本地文件夹，并生成一份当前所有已存在文件的“清单”。
2.  **下载与监控 (Download & Monitor)**：随后，脚本正常启动 `gallery-dl` 开始下载。它会实时捕获 `gallery-dl` 的输出，每当有一个文件下载完成时，脚本就会检查这个文件名是否在之前的“清单”中。
3.  **智能中断 (Smart Termination)**：如果文件名存在于清单中，证明已下载到旧内容，脚本会立即终止当前的 `gallery-dl` 进程，并继续处理列表中的下一个用户。

## 致谢

本项目完全基于 **[gallery-dl](https://github.com/mikf/gallery-dl)**，并作为其上层的一个自动化流程封装。所有核心的下载功能均由 `gallery-dl` 完成。

非常感谢 `gallery-dl` 的开发者们创造出如此强大和灵活的工具！

## 许可证

本项目采用 [MIT 许可证](https://opensource.org/licenses/MIT)。